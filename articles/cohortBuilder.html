<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cohortBuilder">
<title>Introduction to cohortBuilder • cohortBuilder</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to cohortBuilder">
<meta property="og:description" content="cohortBuilder">
<meta property="og:image" content="https://r-world-devs.github.io/cohortBuilder/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cohortBuilder</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/cohortBuilder.html">
    <span class="fa fa fa fa-thumbs-o-up"></span>
     
    Get started
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--articles">
    <span class="fa fa fa fa-thumbs-o-up"></span>
     
    Articles
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--articles">
    <a class="dropdown-item" href="../articles/managing-cohort.html">Managing Cohort Object</a>
    <a class="dropdown-item" href="../articles/cohort-configuration.html">Variants for Cohort Configuration</a>
    <a class="dropdown-item" href="../articles/binding-keys.html">Specifying data relations with Binding Keys</a>
    <a class="dropdown-item" href="../articles/custom-filters.html">Implementing custom filters</a>
    <a class="dropdown-item" href="../articles/custom-extensions.html">Writing custom extensions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">
    <span class="fa fa fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://r-world-devs.github.io/cohortBuilder/issues">
    <span class="fa fa fa fa-ambulance"></span>
     
    Issues
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-world-devs/cohortBuilder/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to cohortBuilder</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-world-devs/cohortBuilder/blob/HEAD/vignettes/cohortBuilder.Rmd" class="external-link"><code>vignettes/cohortBuilder.Rmd</code></a></small>
      <div class="d-none name"><code>cohortBuilder.Rmd</code></div>
    </div>

    
    
<p>This document presents to you basic functionality offered by
<code>cohortBuilder</code> package. You’ll learn here about Source and
Cohort objects, how to configure them with filters and filtering steps.
Later on, we’ll present most common Cohort methods that allow to
manipulate the object and extract useful information about Cohort data
and state.</p>
<div class="section level2">
<h2 id="cohortbuilder-vs--dplyr">cohortBuilder vs. dplyr<a class="anchor" aria-label="anchor" href="#cohortbuilder-vs--dplyr"></a>
</h2>
<p>If you’re familiar with <code>dplyr</code> (or any other data
manipulation package) you may be wondering what
<code>cohortBuilder</code> has been created for.</p>
<p>Our main goal for creating <code>cohortBuilder</code> was to provide
a common syntax for operating (filtering) on any data source you need.
This follows the idea for having <code>dplyr</code> and its database
counterpart <code>dbplyr</code> package.</p>
<p>In order to achieve the goal, we put an emphasis on possibility to
write custom extensions in terms of data source type, or operating
backend (underneath <code>cohortBuilder</code> uses <code>dplyr</code>
to operate on data frames, but you may create an extension using
e.g. <code>data.table</code>). See
<code><a href="../articles/custom-extensions.html">vignette("custom-extensions")</a></code>.</p>
<p>The second goal was integration of <code>cohortBuilder</code> with
<code>shiny</code>. The GUI for <code>cohortBuilder</code> is provided
by <code>shinyCohortBuilder</code> package. With this extension you may
easily open Cohort configuration panel locally, or include it in you
custom dashboard.</p>
</div>
<div class="section level2">
<h2 id="data-librarian">Data: librarian<a class="anchor" aria-label="anchor" href="#data-librarian"></a>
</h2>
<p>To present <code>cohortBuilder</code>’s functionality we’ll be
operating on <code>librarian</code> dataset. <code>librarian</code> is a
list of four tables, storing a sample of book library management
database.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cohortBuilder</span><span class="fu">::</span><span class="va"><a href="../reference/librarian.html">librarian</a></span></span>
<span><span class="co">#&gt; $books</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 17 × 6</span></span></span>
<span><span class="co">#&gt;   isbn              title                          genre publisher author copies</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0-385-50420-9     The Da Vinci Code              Crim… Transwor… Dan B…      7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0-7679-0817-1     A Short History of Nearly Eve… Popu… Transwor… Bill …      4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 978-0-15-602943-8 The Time Traveler's Wife       Gene… Random H… Audre…      2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0-224-06252-2     Atonement                      Gene… Random H… Ian M…      8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 0-676-97376-0     Life of Pi                     Gene… Canongate Yann …     11</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $borrowers</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 6</span></span></span>
<span><span class="co">#&gt;   id     registered address                           name  phone_number program</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 2001-06-09 66 N. Evergreen Ave. Norristown,… Mrs.… 626-594-4729 premium</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000002 2002-08-10 8196 Windsor Road Muscatine, IA … Ms. … 919-530-5272 standa…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000003 2003-02-15 6 Wood Lane Calumet City, IL 604… Inga… 706-669-5694 <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000004 2004-06-14 18 Nut Swamp Road Merrimack, NH … Keys… 746-328-6598 standa…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000005 2005-01-15 580 Chapel Rd. Delray Beach, FL … Ferd… 127-363-0738 premium</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $issues</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 50 × 4</span></span></span>
<span><span class="co">#&gt;   id     borrower_id isbn              date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 000019      0-676-97976-9     2015-03-17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000002 000010      978-0-7528-6053-4 2008-09-13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000003 000016      0-09-177373-3     2014-09-28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000004 000005      0-224-06252-2     2005-11-14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000005 000004      0-340-89696-5     2006-03-19</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 45 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $returns</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 × 2</span></span></span>
<span><span class="co">#&gt;   id     date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 2015-04-06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000003 2014-10-23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000004 2005-12-29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000005 2006-03-26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000006 2016-08-30</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 25 more rows</span></span></span></code></pre></div>
<p>To learn more check <code><a href="../reference/librarian.html">?librarian</a></code>.</p>
</div>
<div class="section level2">
<h2 id="source-object">Source object<a class="anchor" aria-label="anchor" href="#source-object"></a>
</h2>
<p>Every time you work with <code>cohortBuilder</code> the crucial part
is to properly define the data source with <code>set_source</code>
function. Source is an R6 object storing metadata about data and its
origin. The metadata allows <code>cohortBuilder</code> to distinct what
methods to use when performing operations on it.</p>
<p>To define a new source you need to provide data (connection).</p>
<p>Let’s create now a new source storing <code>librarian</code> data. To
do so, we pass one obligatory parameter <code>dtconn</code> to
<code>set_source</code> method.</p>
<p><code>dtconn</code> stores data connection responsible for informing
<code>cohortBuilder</code> on what data are we gonna work (and what
extension to use, if any).</p>
<p>If you want to operate on R-loaded list of tables, provide
<code>tblist</code> class object. <code>tblist</code> is just a named
list of data frames having <code>tblist</code> class.</p>
<p><strong>Note.</strong> In order to create ‘tblist’ object use
<code>tblist</code>, e.g. <code>tblist(mtcars, iris)</code>.
<strong>Note.</strong> In order to convert list of data frames to
‘tblist’ just use <code>as.tblist</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/tblist.html">as.tblist</a></span><span class="op">(</span><span class="va">librarian</span><span class="op">)</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 4</span></span>
<span><span class="co">#&gt;  $ books    : tibble [17 × 6] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ borrowers: tibble [20 × 6] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ issues   : tibble [50 × 4] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ returns  : tibble [30 × 2] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "tblist"</span></span></code></pre></div>
<p>Let’s proceed with creating the source:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">librarian_source</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_source.html">set_source</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/tblist.html">as.tblist</a></span><span class="op">(</span><span class="va">librarian</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">librarian_source</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tblist" "Source" "R6"</span></span></code></pre></div>
<p>To learn more about <code>set_source</code>’s arguments check
<code><a href="../reference/set_source.html">?set_source</a></code>.</p>
</div>
<div class="section level2">
<h2 id="cohort-object">Cohort object<a class="anchor" aria-label="anchor" href="#cohort-object"></a>
</h2>
<p>When <code>Source</code> object is ready, the next step is to create
a <code>Cohort</code> object. <code>Cohort</code> is again an R6 object,
providing methods for operating on data included in
<code>Source</code>.</p>
<p><code>Cohort</code> is responsible in particular for:</p>
<ul>
<li>storing definitions of filters (and filtering steps),</li>
<li>running filtering and keeping result of it,</li>
<li>computing and caching filter and data statistics,</li>
<li>keeping and updating filtering configuration state.</li>
</ul>
<p>In the standard workflow we build <code>Cohort</code> on top of
<code>Source</code>. We achieve it with <code>cohort</code>
function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">librarian_cohort</span> <span class="op">&lt;-</span> <span class="va">librarian_source</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/create-cohort.html">cohort</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">librarian_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Cohort" "R6"</span></span></code></pre></div>
<p>With the existing <code>Cohort</code> we may get underlying data with
<code>get_data</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">librarian_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; $books</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 17 × 6</span></span></span>
<span><span class="co">#&gt;   isbn              title                          genre publisher author copies</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0-385-50420-9     The Da Vinci Code              Crim… Transwor… Dan B…      7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0-7679-0817-1     A Short History of Nearly Eve… Popu… Transwor… Bill …      4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 978-0-15-602943-8 The Time Traveler's Wife       Gene… Random H… Audre…      2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0-224-06252-2     Atonement                      Gene… Random H… Ian M…      8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 0-676-97376-0     Life of Pi                     Gene… Canongate Yann …     11</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $borrowers</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 6</span></span></span>
<span><span class="co">#&gt;   id     registered address                           name  phone_number program</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 2001-06-09 66 N. Evergreen Ave. Norristown,… Mrs.… 626-594-4729 premium</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000002 2002-08-10 8196 Windsor Road Muscatine, IA … Ms. … 919-530-5272 standa…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000003 2003-02-15 6 Wood Lane Calumet City, IL 604… Inga… 706-669-5694 <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000004 2004-06-14 18 Nut Swamp Road Merrimack, NH … Keys… 746-328-6598 standa…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000005 2005-01-15 580 Chapel Rd. Delray Beach, FL … Ferd… 127-363-0738 premium</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $issues</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 50 × 4</span></span></span>
<span><span class="co">#&gt;   id     borrower_id isbn              date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 000019      0-676-97976-9     2015-03-17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000002 000010      978-0-7528-6053-4 2008-09-13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000003 000016      0-09-177373-3     2014-09-28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000004 000005      0-224-06252-2     2005-11-14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000005 000004      0-340-89696-5     2006-03-19</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 45 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $returns</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 × 2</span></span></span>
<span><span class="co">#&gt;   id     date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 2015-04-06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000003 2014-10-23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000004 2005-12-29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000005 2006-03-26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000006 2016-08-30</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 25 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "tblist"</span></span>
<span><span class="co">#&gt; attr(,"call")</span></span>
<span><span class="co">#&gt; as.tblist(librarian)</span></span></code></pre></div>
<p>We’ll present more methods in the next sections.</p>
</div>
<div class="section level2">
<h2 id="configuring-and-running-filters">Configuring and running filters<a class="anchor" aria-label="anchor" href="#configuring-and-running-filters"></a>
</h2>
<p>The next step in <code>cohortBuilder</code> workflow is configuration
of filters. Filters are responsible for providing necessary logic for
performing related data filtering.</p>
<p>The extensive description of filters can be found at
<code><a href="../articles/custom-filters.html">vignette("custom-filters")</a></code>.</p>
<p>The current version of <code>cohortBuilder</code> provides five types
of build-in filters:</p>
<ul>
<li>
<strong>discrete</strong> - return values (in column) matching
provided set,</li>
<li>
<strong>discrete_text</strong> - return values based on provided
comma separated values,</li>
<li>
<strong>range</strong> - return values within the provided
range,</li>
<li>
<strong>date_range</strong> - range version for Date type data,</li>
<li>
<strong>multi_discrete</strong> - extended version of discrete
filter working with multiple conditions.</li>
</ul>
<p>Let’s define discrete filter that will subset <code>books</code>
table listing books written by Dan Brown.<br>
To do so, we have to define the following parameters calling
<code>filter</code> function:</p>
<ul>
<li>
<code>type</code> - type of the filter (one of the above),</li>
<li>
<code>dataset</code> - name of the dataset to apply the filter
to,</li>
<li>
<code>variable</code> - name of the variable in <code>dataset</code>
to apply the filter to,</li>
<li>
<code>value</code> - vector of values to be applied in filter.</li>
</ul>
<p>So in our case:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">author_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>  <span class="st">"discrete"</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"books"</span>,</span>
<span>  variable <span class="op">=</span> <span class="st">"author"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"Dan Brown"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In order to add the filter to existing Cohort we may use
<code>add_filter</code> method:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">librarian_cohort</span> <span class="op">&lt;-</span> <span class="va">librarian_cohort</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_filter.html">add_filter</a></span><span class="op">(</span><span class="va">author_filter</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively we may use <code>%-&gt;%</code> operator that calls
<code>add_filter</code> underneath:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">librarian_cohort</span> <span class="op">&lt;-</span> <span class="va">librarian_cohort</span> <span class="op"><a href="../reference/grapes-greater-than-grapes.html">%-&gt;%</a></span></span>
<span>  <span class="va">author_filter</span></span></code></pre></div>
<p>Or define the filter while creating Cohort:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">librarian_cohort</span> <span class="op">&lt;-</span> <span class="va">librarian_source</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/create-cohort.html">cohort</a></span><span class="op">(</span></span>
<span>    <span class="va">author_filter</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>There are much more options for defining filters. To learn more check
<code><a href="../articles/cohort-configuration.html">vignette("cohort-configuration")</a></code>.</p>
<p><strong>Note.</strong> Cohort is an R6 object, so you may skip
reassignment above.</p>
<p>For example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">librarian_cohort</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_filter.html">add_filter</a></span><span class="op">(</span><span class="va">author_filter</span><span class="op">)</span></span></code></pre></div>
<p>will also work.</p>
<p><strong>Note.</strong> To verify if the filter was configured
properly just run:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sum_up.html">sum_up</a></span><span class="op">(</span><span class="va">librarian_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; &gt;&gt; Step ID: 1</span></span>
<span><span class="co">#&gt; -&gt; Filter ID: CZNWQ1727428005407</span></span>
<span><span class="co">#&gt;    Filter Type: discrete</span></span>
<span><span class="co">#&gt;    Filter Parameters:</span></span>
<span><span class="co">#&gt;      dataset: books</span></span>
<span><span class="co">#&gt;      variable: author</span></span>
<span><span class="co">#&gt;      value: Dan Brown</span></span>
<span><span class="co">#&gt;      keep_na: TRUE</span></span>
<span><span class="co">#&gt;      description: </span></span>
<span><span class="co">#&gt;      active: TRUE</span></span></code></pre></div>
<p>The output highlights list of configured filters along with their
parameters. You can see here the id attached to filter and some extra
parameters such as <code>keep_na</code> or <code>active</code> which we
describe in the next sections.</p>
<p>More to that we can realize the filter was defined in the step with
ID equals to 1. That’s because <code>cohortBuilder</code> allows to
perform <a href="#multi-stage-filtering">multi-stage filtering</a>.</p>
<p>Let’s get back to filtering the <code>books</code>. Configuring
filters only adds proper metadata in the Cohort object, which means data
filtering is not performed automatically. This allows to set the proper
configuration first, and run calculation only once.</p>
<p>If you want to run data filtering, just call <code>run</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">librarian_cohort</span><span class="op">)</span></span></code></pre></div>
<p>Let’s check if the operation worked fine by checking the resulting
data:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">librarian_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; $books</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">#&gt;   isbn          title             genre                  publisher author copies</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0-385-50420-9 The Da Vinci Code Crime, Thriller &amp; Adv… Transwor… Dan B…      7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0-671-02735-2 Angels and Demons Crime, Thriller &amp; Adv… Transwor… Dan B…      4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $borrowers</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 6</span></span></span>
<span><span class="co">#&gt;   id     registered address                           name  phone_number program</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 2001-06-09 66 N. Evergreen Ave. Norristown,… Mrs.… 626-594-4729 premium</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000002 2002-08-10 8196 Windsor Road Muscatine, IA … Ms. … 919-530-5272 standa…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000003 2003-02-15 6 Wood Lane Calumet City, IL 604… Inga… 706-669-5694 <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000004 2004-06-14 18 Nut Swamp Road Merrimack, NH … Keys… 746-328-6598 standa…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000005 2005-01-15 580 Chapel Rd. Delray Beach, FL … Ferd… 127-363-0738 premium</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $issues</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 50 × 4</span></span></span>
<span><span class="co">#&gt;   id     borrower_id isbn              date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 000019      0-676-97976-9     2015-03-17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000002 000010      978-0-7528-6053-4 2008-09-13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000003 000016      0-09-177373-3     2014-09-28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000004 000005      0-224-06252-2     2005-11-14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000005 000004      0-340-89696-5     2006-03-19</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 45 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $returns</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 × 2</span></span></span>
<span><span class="co">#&gt;   id     date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 2015-04-06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000003 2014-10-23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000004 2005-12-29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000005 2006-03-26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000006 2016-08-30</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 25 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "tblist"</span></span>
<span><span class="co">#&gt; attr(,"call")</span></span>
<span><span class="co">#&gt; as.tblist(librarian)</span></span></code></pre></div>
<p>If you want to run data filtering automatically when the filter is
defined you can set <code>run_flow = TRUE</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">librarian_cohort</span> <span class="op">&lt;-</span> <span class="va">librarian_source</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/create-cohort.html">cohort</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/add_filter.html">add_filter</a></span><span class="op">(</span><span class="va">author_filter</span>, run_flow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>when using <code>add_filter</code> or:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">librarian_cohort</span> <span class="op">&lt;-</span> <span class="va">librarian_source</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/create-cohort.html">cohort</a></span><span class="op">(</span></span>
<span>    <span class="va">author_filter</span>,</span>
<span>    run_flow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>when configuring filter along with creating cohort.</p>
<p>Now when the data filtered, how can we get data state before
filtering? With <code>get_data</code> it’s easy, just set
<code>state = "pre"</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">librarian_cohort</span>, state <span class="op">=</span> <span class="st">"pre"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $books</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 17 × 6</span></span></span>
<span><span class="co">#&gt;   isbn              title                          genre publisher author copies</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0-385-50420-9     The Da Vinci Code              Crim… Transwor… Dan B…      7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0-7679-0817-1     A Short History of Nearly Eve… Popu… Transwor… Bill …      4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 978-0-15-602943-8 The Time Traveler's Wife       Gene… Random H… Audre…      2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 0-224-06252-2     Atonement                      Gene… Random H… Ian M…      8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 0-676-97376-0     Life of Pi                     Gene… Canongate Yann …     11</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $borrowers</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 6</span></span></span>
<span><span class="co">#&gt;   id     registered address                           name  phone_number program</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 2001-06-09 66 N. Evergreen Ave. Norristown,… Mrs.… 626-594-4729 premium</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000002 2002-08-10 8196 Windsor Road Muscatine, IA … Ms. … 919-530-5272 standa…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000003 2003-02-15 6 Wood Lane Calumet City, IL 604… Inga… 706-669-5694 <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000004 2004-06-14 18 Nut Swamp Road Merrimack, NH … Keys… 746-328-6598 standa…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000005 2005-01-15 580 Chapel Rd. Delray Beach, FL … Ferd… 127-363-0738 premium</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $issues</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 50 × 4</span></span></span>
<span><span class="co">#&gt;   id     borrower_id isbn              date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 000019      0-676-97976-9     2015-03-17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000002 000010      978-0-7528-6053-4 2008-09-13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000003 000016      0-09-177373-3     2014-09-28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000004 000005      0-224-06252-2     2005-11-14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000005 000004      0-340-89696-5     2006-03-19</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 45 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $returns</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 × 2</span></span></span>
<span><span class="co">#&gt;   id     date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 2015-04-06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000003 2014-10-23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000004 2005-12-29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000005 2006-03-26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000006 2016-08-30</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 25 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "tblist"</span></span>
<span><span class="co">#&gt; attr(,"call")</span></span>
<span><span class="co">#&gt; as.tblist(librarian)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multi-stage-filtering">Multi-stage filtering<a class="anchor" aria-label="anchor" href="#multi-stage-filtering"></a>
</h2>
<p>With <code>cohortBuilder</code> you can define filters in groups
named ‘steps’ or ‘filtering steps’.</p>
<p>Filtering steps allow you to sequentially perform groups of filtering
operations. In order to define step, just wrap set of filters in
<code>step</code> function.</p>
<p>We will define three filters:</p>
<ol style="list-style-type: decimal">
<li>Taking all the books written by Dan Brown.</li>
<li>Filtering only the members (borrowers) with “standard” program.</li>
<li>Taking only the books with less than 5 copies.</li>
</ol>
<p>We’ll include filters 1. and 2. in the first step - filter 3. in the
second one.</p>
<p>The below code does the job:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">librarian_cohort</span> <span class="op">&lt;-</span> <span class="va">librarian_source</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/create-cohort.html">cohort</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/step.html">step</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>        <span class="st">"discrete"</span>, id <span class="op">=</span> <span class="st">"author"</span>, dataset <span class="op">=</span> <span class="st">"books"</span>, </span>
<span>        variable <span class="op">=</span> <span class="st">"author"</span>, value <span class="op">=</span> <span class="st">"Dan Brown"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>        <span class="st">"discrete"</span>, id <span class="op">=</span> <span class="st">"program"</span>, dataset <span class="op">=</span> <span class="st">"borrowers"</span>, </span>
<span>        variable <span class="op">=</span> <span class="st">"program"</span>, value <span class="op">=</span> <span class="st">"premium"</span>, keep_na <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/step.html">step</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>        <span class="st">"range"</span>, id <span class="op">=</span> <span class="st">"copies"</span>, dataset <span class="op">=</span> <span class="st">"books"</span>, </span>
<span>        variable <span class="op">=</span> <span class="st">"copies"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">5</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Let’s note a few parts that occurred above:</p>
<ul>
<li>For each filter we defined <code>id</code> parameter. This assigns
provided id to each filter what makes accessing it later much
easier.</li>
<li>For ‘program’ filter we set <code>keep_na = FALSE</code> what
results with excluding <code>NA</code> values (the parameter is
available for each filter type).</li>
<li>For filtering number of copies we’ve used <code>range</code> filter,
for which sub-setting value is defined with <code>range</code>
parameter.</li>
</ul>
<p>Let’s check the Cohort configuration:,</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sum_up.html">sum_up</a></span><span class="op">(</span><span class="va">librarian_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; &gt;&gt; Step ID: 1</span></span>
<span><span class="co">#&gt; -&gt; Filter ID: author</span></span>
<span><span class="co">#&gt;    Filter Type: discrete</span></span>
<span><span class="co">#&gt;    Filter Parameters:</span></span>
<span><span class="co">#&gt;      dataset: books</span></span>
<span><span class="co">#&gt;      variable: author</span></span>
<span><span class="co">#&gt;      value: Dan Brown</span></span>
<span><span class="co">#&gt;      keep_na: TRUE</span></span>
<span><span class="co">#&gt;      description: </span></span>
<span><span class="co">#&gt;      active: TRUE</span></span>
<span><span class="co">#&gt; -&gt; Filter ID: program</span></span>
<span><span class="co">#&gt;    Filter Type: discrete</span></span>
<span><span class="co">#&gt;    Filter Parameters:</span></span>
<span><span class="co">#&gt;      dataset: borrowers</span></span>
<span><span class="co">#&gt;      variable: program</span></span>
<span><span class="co">#&gt;      value: premium</span></span>
<span><span class="co">#&gt;      keep_na: FALSE</span></span>
<span><span class="co">#&gt;      description: </span></span>
<span><span class="co">#&gt;      active: TRUE</span></span>
<span><span class="co">#&gt; &gt;&gt; Step ID: 2</span></span>
<span><span class="co">#&gt; -&gt; Filter ID: copies</span></span>
<span><span class="co">#&gt;    Filter Type: range</span></span>
<span><span class="co">#&gt;    Filter Parameters:</span></span>
<span><span class="co">#&gt;      dataset: books</span></span>
<span><span class="co">#&gt;      variable: copies</span></span>
<span><span class="co">#&gt;      range: -Inf, 5</span></span>
<span><span class="co">#&gt;      keep_na: TRUE</span></span>
<span><span class="co">#&gt;      description: </span></span>
<span><span class="co">#&gt;      active: TRUE</span></span></code></pre></div>
<p>We can see filters were correctly assigned to each step.</p>
<p>Having multiple steps defined, we can use <code>get_data</code> to
extract resulting data after each step. In order to precise the step we
want to get data from, just pass its id as <code>step_id</code>
parameter:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">librarian_cohort</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">librarian_cohort</span>, step_id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; $books</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">#&gt;   isbn          title             genre                  publisher author copies</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0-385-50420-9 The Da Vinci Code Crime, Thriller &amp; Adv… Transwor… Dan B…      7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0-671-02735-2 Angels and Demons Crime, Thriller &amp; Adv… Transwor… Dan B…      4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $borrowers</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   id     registered address                           name  phone_number program</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 2001-06-09 66 N. Evergreen Ave. Norristown,… Mrs.… 626-594-4729 premium</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000005 2005-01-15 580 Chapel Rd. Delray Beach, FL … Ferd… 127-363-0738 premium</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000008 2006-11-15 9533 Delaware Dr. Peabody, MA 01… Mrs.… 460-779-8714 premium</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000011 2009-03-24 745 E. Sussex Drive Mahwah, NJ 0… Mr. … 378-884-6509 premium</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000013 2011-09-30 534 Iroquois Ave. Watertown, MA … Dr. … 104-832-8013 premium</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more row</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $issues</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 50 × 4</span></span></span>
<span><span class="co">#&gt;   id     borrower_id isbn              date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 000019      0-676-97976-9     2015-03-17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000002 000010      978-0-7528-6053-4 2008-09-13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000003 000016      0-09-177373-3     2014-09-28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000004 000005      0-224-06252-2     2005-11-14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000005 000004      0-340-89696-5     2006-03-19</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 45 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $returns</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 × 2</span></span></span>
<span><span class="co">#&gt;   id     date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 2015-04-06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000003 2014-10-23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000004 2005-12-29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000005 2006-03-26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000006 2016-08-30</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 25 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "tblist"</span></span>
<span><span class="co">#&gt; attr(,"call")</span></span>
<span><span class="co">#&gt; as.tblist(librarian)</span></span>
<span><span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">librarian_cohort</span>, step_id <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; $books</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">#&gt;   isbn          title             genre                  publisher author copies</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0-671-02735-2 Angels and Demons Crime, Thriller &amp; Adv… Transwor… Dan B…      4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $borrowers</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   id     registered address                           name  phone_number program</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 2001-06-09 66 N. Evergreen Ave. Norristown,… Mrs.… 626-594-4729 premium</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000005 2005-01-15 580 Chapel Rd. Delray Beach, FL … Ferd… 127-363-0738 premium</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000008 2006-11-15 9533 Delaware Dr. Peabody, MA 01… Mrs.… 460-779-8714 premium</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000011 2009-03-24 745 E. Sussex Drive Mahwah, NJ 0… Mr. … 378-884-6509 premium</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000013 2011-09-30 534 Iroquois Ave. Watertown, MA … Dr. … 104-832-8013 premium</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more row</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $issues</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 50 × 4</span></span></span>
<span><span class="co">#&gt;   id     borrower_id isbn              date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 000019      0-676-97976-9     2015-03-17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000002 000010      978-0-7528-6053-4 2008-09-13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000003 000016      0-09-177373-3     2014-09-28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000004 000005      0-224-06252-2     2005-11-14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000005 000004      0-340-89696-5     2006-03-19</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 45 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $returns</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 × 2</span></span></span>
<span><span class="co">#&gt;   id     date      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 000001 2015-04-06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 000003 2014-10-23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 000004 2005-12-29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 000005 2006-03-26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 000006 2016-08-30</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 25 more rows</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "tblist"</span></span>
<span><span class="co">#&gt; attr(,"call")</span></span>
<span><span class="co">#&gt; as.tblist(librarian)</span></span></code></pre></div>
<p><strong>Note.</strong> When <code>step_id</code> is not provided, the
method returns the last step data.</p>
<p><strong>Note.</strong> You may precise if you want to extract data
before or after filtering using <code>state</code> parameter. Because
the proceeding step uses result from the previous one, we have:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">librarian_cohort</span>, step_id <span class="op">=</span> <span class="fl">1</span>, state <span class="op">=</span> <span class="st">"post"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">librarian_cohort</span>, step_id <span class="op">=</span> <span class="fl">2</span>, state <span class="op">=</span> <span class="st">"pre"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exploring-the-cohort-object-methods">Exploring the Cohort object methods<a class="anchor" aria-label="anchor" href="#exploring-the-cohort-object-methods"></a>
</h2>
<div class="section level3">
<h3 id="learning-more-about-the-source-data">Learning more about the source data<a class="anchor" aria-label="anchor" href="#learning-more-about-the-source-data"></a>
</h3>
<p>Having Cohort object created, you may want to use its methods for
exploring underlying data.</p>
<p>With methods such as:</p>
<ul>
<li>
<code>stat</code>,</li>
<li>
<code>plot_data</code>,</li>
<li><code>attrition</code></li>
</ul>
<p>you can:</p>
<ul>
<li>get filter related data statistics,</li>
<li>display filter related data on plot,</li>
<li>display data changes across filtering steps.</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/stat.html">stat</a></span><span class="op">(</span><span class="va">librarian_cohort</span>, step_id <span class="op">=</span> <span class="fl">1</span>, filter_id <span class="op">=</span> <span class="st">"program"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $n_data</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $choices</span></span>
<span><span class="co">#&gt; $choices$premium</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_missing</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="fu"><a href="../reference/stat.html">stat</a></span><span class="op">(</span><span class="va">librarian_cohort</span>, step_id <span class="op">=</span> <span class="fl">2</span>, filter_id <span class="op">=</span> <span class="st">"copies"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $n_data</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $frequencies</span></span>
<span><span class="co">#&gt;   level count l_bound u_bound</span></span>
<span><span class="co">#&gt; 1     1     1       4       4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $n_missing</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_data.html">plot_data</a></span><span class="op">(</span><span class="va">librarian_cohort</span>, step_id <span class="op">=</span> <span class="fl">1</span>, filter_id <span class="op">=</span> <span class="st">"program"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cohortBuilder_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_data.html">plot_data</a></span><span class="op">(</span><span class="va">librarian_cohort</span>, step_id <span class="op">=</span> <span class="fl">2</span>, filter_id <span class="op">=</span> <span class="st">"copies"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cohortBuilder_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/attrition.html">attrition</a></span><span class="op">(</span><span class="va">librarian_cohort</span>, dataset <span class="op">=</span> <span class="st">"books"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cohortBuilder_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/attrition.html">attrition</a></span><span class="op">(</span><span class="va">librarian_cohort</span>, dataset <span class="op">=</span> <span class="st">"borrowers"</span><span class="op">)</span></span></code></pre></div>
<p><img src="cohortBuilder_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="sharing-code-and-reproducibility">Sharing code and reproducibility<a class="anchor" aria-label="anchor" href="#sharing-code-and-reproducibility"></a>
</h3>
<p>The <code>cohortBuilder</code> package offers some methods to make
sharing the workflow easier.</p>
<p>With <code>code</code>, you may get the reproducible code written
using methods operating on specific source (i.e. <code>dplyr</code> for
<code>tblist</code> and <code>dbplyr</code> for <code>db</code>
source):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/code.html">code</a></span><span class="op">(</span><span class="va">librarian_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; .pre_filtering &lt;- function(source, data_object, step_id) {</span></span>
<span><span class="co">#&gt;     for (dataset in names(data_object)) {</span></span>
<span><span class="co">#&gt;         attr(data_object[[dataset]], "filtered") &lt;- FALSE</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     return(data_object)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; .run_binding &lt;- function(source, binding_key, data_object_pre, data_object_post,</span></span>
<span><span class="co">#&gt;     ...) {</span></span>
<span><span class="co">#&gt;     binding_dataset &lt;- binding_key$update$dataset</span></span>
<span><span class="co">#&gt;     dependent_datasets &lt;- names(binding_key$data_keys)</span></span>
<span><span class="co">#&gt;     active_datasets &lt;- data_object_post %&gt;%</span></span>
<span><span class="co">#&gt;         purrr::keep(~attr(., "filtered")) %&gt;%</span></span>
<span><span class="co">#&gt;         names()</span></span>
<span><span class="co">#&gt;     if (!any(dependent_datasets %in% active_datasets)) {</span></span>
<span><span class="co">#&gt;         return(data_object_post)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     key_values &lt;- NULL</span></span>
<span><span class="co">#&gt;     common_key_names &lt;- paste0("key_", seq_along(binding_key$data_keys[[1]]$key))</span></span>
<span><span class="co">#&gt;     for (dependent_dataset in dependent_datasets) {</span></span>
<span><span class="co">#&gt;         key_names &lt;- binding_key$data_keys[[dependent_dataset]]$key</span></span>
<span><span class="co">#&gt;         tmp_key_values &lt;- dplyr::distinct(data_object_post[[dependent_dataset]][,</span></span>
<span><span class="co">#&gt;             key_names, drop = FALSE]) %&gt;%</span></span>
<span><span class="co">#&gt;             stats::setNames(common_key_names)</span></span>
<span><span class="co">#&gt;         if (is.null(key_values)) {</span></span>
<span><span class="co">#&gt;             key_values &lt;- tmp_key_values</span></span>
<span><span class="co">#&gt;         } else {</span></span>
<span><span class="co">#&gt;             key_values &lt;- dplyr::inner_join(key_values, tmp_key_values, by = common_key_names)</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     data_object_post[[binding_dataset]] &lt;- dplyr::inner_join(switch(as.character(binding_key$post),</span></span>
<span><span class="co">#&gt;         `FALSE` = data_object_pre[[binding_dataset]], `TRUE` = data_object_post[[binding_dataset]]),</span></span>
<span><span class="co">#&gt;         key_values, by = stats::setNames(common_key_names, binding_key$update$key))</span></span>
<span><span class="co">#&gt;     if (binding_key$activate) {</span></span>
<span><span class="co">#&gt;         attr(data_object_post[[binding_dataset]], "filtered") &lt;- TRUE</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     return(data_object_post)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; source &lt;- list(dtconn = as.tblist(librarian))</span></span>
<span><span class="co">#&gt; data_object &lt;- source$dtconn</span></span>
<span><span class="co">#&gt; step_id &lt;- "1"</span></span>
<span><span class="co">#&gt; pre_data_object &lt;- data_object</span></span>
<span><span class="co">#&gt; data_object &lt;- .pre_filtering(source, data_object, "1")</span></span>
<span><span class="co">#&gt; data_object[["books"]] &lt;- data_object[["books"]] %&gt;%</span></span>
<span><span class="co">#&gt;     dplyr::filter(author %in% c("Dan Brown", NA))</span></span>
<span><span class="co">#&gt; attr(data_object[["books"]], "filtered") &lt;- TRUE</span></span>
<span><span class="co">#&gt; data_object[["borrowers"]] &lt;- data_object[["borrowers"]] %&gt;%</span></span>
<span><span class="co">#&gt;     dplyr::filter(program %in% "premium")</span></span>
<span><span class="co">#&gt; attr(data_object[["borrowers"]], "filtered") &lt;- TRUE</span></span>
<span><span class="co">#&gt; data_object &lt;- .post_filtering(source, data_object, "1")</span></span>
<span><span class="co">#&gt; for (binding_key in binding_keys) {</span></span>
<span><span class="co">#&gt;     data_object &lt;- .run_binding(source, binding_key, pre_data_object, data_object)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; step_id &lt;- "2"</span></span>
<span><span class="co">#&gt; data_object &lt;- .pre_filtering(source, data_object, "2")</span></span>
<span><span class="co">#&gt; data_object[["books"]] &lt;- data_object[["books"]] %&gt;%</span></span>
<span><span class="co">#&gt;     dplyr::filter((copies &lt;= 5 &amp; copies &gt;= -Inf) | is.na(copies))</span></span>
<span><span class="co">#&gt; attr(data_object[["books"]], "filtered") &lt;- TRUE</span></span>
<span><span class="co">#&gt; data_object &lt;- .post_filtering(source, data_object, "2")</span></span></code></pre></div>
<p>We can see above, the resulting code uses <code>source</code> object,
which creation code can be defined separately while creating it:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">librarian_source</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_source.html">set_source</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/tblist.html">as.tblist</a></span><span class="op">(</span><span class="va">librarian</span><span class="op">)</span>,</span>
<span>  source_code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">source</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">source</span><span class="op">$</span><span class="va">dtconn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tblist.html">as.tblist</a></span><span class="op">(</span><span class="va">librarian</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">librarian_cohort</span> <span class="op">&lt;-</span> <span class="va">librarian_source</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/create-cohort.html">cohort</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/step.html">step</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>        <span class="st">"discrete"</span>, id <span class="op">=</span> <span class="st">"author"</span>, dataset <span class="op">=</span> <span class="st">"books"</span>, </span>
<span>        variable <span class="op">=</span> <span class="st">"author"</span>, value <span class="op">=</span> <span class="st">"Dan Brown"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>        <span class="st">"discrete"</span>, id <span class="op">=</span> <span class="st">"program"</span>, dataset <span class="op">=</span> <span class="st">"borrowers"</span>, </span>
<span>        variable <span class="op">=</span> <span class="st">"program"</span>, value <span class="op">=</span> <span class="st">"premium"</span>, keep_na <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/step.html">step</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>        <span class="st">"range"</span>, id <span class="op">=</span> <span class="st">"copies"</span>, dataset <span class="op">=</span> <span class="st">"books"</span>, </span>
<span>        variable <span class="op">=</span> <span class="st">"copies"</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">5</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    run_flow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/code.html">code</a></span><span class="op">(</span><span class="va">librarian_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; .pre_filtering &lt;- function(source, data_object, step_id) {</span></span>
<span><span class="co">#&gt;     for (dataset in names(data_object)) {</span></span>
<span><span class="co">#&gt;         attr(data_object[[dataset]], "filtered") &lt;- FALSE</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     return(data_object)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; .run_binding &lt;- function(source, binding_key, data_object_pre, data_object_post,</span></span>
<span><span class="co">#&gt;     ...) {</span></span>
<span><span class="co">#&gt;     binding_dataset &lt;- binding_key$update$dataset</span></span>
<span><span class="co">#&gt;     dependent_datasets &lt;- names(binding_key$data_keys)</span></span>
<span><span class="co">#&gt;     active_datasets &lt;- data_object_post %&gt;%</span></span>
<span><span class="co">#&gt;         purrr::keep(~attr(., "filtered")) %&gt;%</span></span>
<span><span class="co">#&gt;         names()</span></span>
<span><span class="co">#&gt;     if (!any(dependent_datasets %in% active_datasets)) {</span></span>
<span><span class="co">#&gt;         return(data_object_post)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     key_values &lt;- NULL</span></span>
<span><span class="co">#&gt;     common_key_names &lt;- paste0("key_", seq_along(binding_key$data_keys[[1]]$key))</span></span>
<span><span class="co">#&gt;     for (dependent_dataset in dependent_datasets) {</span></span>
<span><span class="co">#&gt;         key_names &lt;- binding_key$data_keys[[dependent_dataset]]$key</span></span>
<span><span class="co">#&gt;         tmp_key_values &lt;- dplyr::distinct(data_object_post[[dependent_dataset]][,</span></span>
<span><span class="co">#&gt;             key_names, drop = FALSE]) %&gt;%</span></span>
<span><span class="co">#&gt;             stats::setNames(common_key_names)</span></span>
<span><span class="co">#&gt;         if (is.null(key_values)) {</span></span>
<span><span class="co">#&gt;             key_values &lt;- tmp_key_values</span></span>
<span><span class="co">#&gt;         } else {</span></span>
<span><span class="co">#&gt;             key_values &lt;- dplyr::inner_join(key_values, tmp_key_values, by = common_key_names)</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     data_object_post[[binding_dataset]] &lt;- dplyr::inner_join(switch(as.character(binding_key$post),</span></span>
<span><span class="co">#&gt;         `FALSE` = data_object_pre[[binding_dataset]], `TRUE` = data_object_post[[binding_dataset]]),</span></span>
<span><span class="co">#&gt;         key_values, by = stats::setNames(common_key_names, binding_key$update$key))</span></span>
<span><span class="co">#&gt;     if (binding_key$activate) {</span></span>
<span><span class="co">#&gt;         attr(data_object_post[[binding_dataset]], "filtered") &lt;- TRUE</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     return(data_object_post)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; source &lt;- list()</span></span>
<span><span class="co">#&gt; source$dtconn &lt;- as.tblist(librarian)</span></span>
<span><span class="co">#&gt; data_object &lt;- source$dtconn</span></span>
<span><span class="co">#&gt; step_id &lt;- "1"</span></span>
<span><span class="co">#&gt; pre_data_object &lt;- data_object</span></span>
<span><span class="co">#&gt; data_object &lt;- .pre_filtering(source, data_object, "1")</span></span>
<span><span class="co">#&gt; data_object[["books"]] &lt;- data_object[["books"]] %&gt;%</span></span>
<span><span class="co">#&gt;     dplyr::filter(author %in% c("Dan Brown", NA))</span></span>
<span><span class="co">#&gt; attr(data_object[["books"]], "filtered") &lt;- TRUE</span></span>
<span><span class="co">#&gt; data_object[["borrowers"]] &lt;- data_object[["borrowers"]] %&gt;%</span></span>
<span><span class="co">#&gt;     dplyr::filter(program %in% "premium")</span></span>
<span><span class="co">#&gt; attr(data_object[["borrowers"]], "filtered") &lt;- TRUE</span></span>
<span><span class="co">#&gt; data_object &lt;- .post_filtering(source, data_object, "1")</span></span>
<span><span class="co">#&gt; for (binding_key in binding_keys) {</span></span>
<span><span class="co">#&gt;     data_object &lt;- .run_binding(source, binding_key, pre_data_object, data_object)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; step_id &lt;- "2"</span></span>
<span><span class="co">#&gt; data_object &lt;- .pre_filtering(source, data_object, "2")</span></span>
<span><span class="co">#&gt; data_object[["books"]] &lt;- data_object[["books"]] %&gt;%</span></span>
<span><span class="co">#&gt;     dplyr::filter((copies &lt;= 5 &amp; copies &gt;= -Inf) | is.na(copies))</span></span>
<span><span class="co">#&gt; attr(data_object[["books"]], "filtered") &lt;- TRUE</span></span>
<span><span class="co">#&gt; data_object &lt;- .post_filtering(source, data_object, "2")</span></span></code></pre></div>
<p>What’s more, you can manipulate the output with additional
arguments:</p>
<ul>
<li>
<code>include_methods</code> - list of methods names which
definition should be printed in output,</li>
<li>
<code>include_action</code> - list of actions names (such as
“pre_filtering”) that should be included in output,</li>
<li>
<code>modifier</code> - a custom modifier of data.frame storing
reproducible code parts,</li>
<li>
<code>mark_step</code> - should step ID be presented in output.</li>
</ul>
<p>The second option for achieving reproducibility allows to restore
cohort configuration using its state. The cohort state is a list (or
json) storing information about all the steps and filters
configuration.</p>
<p>You may get the state with <code>get_state</code> method:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_state.html">get_state</a></span><span class="op">(</span><span class="va">librarian_cohort</span>, json <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">state</span></span>
<span><span class="co">#&gt; [{"step":"1","filters":[{"type":"discrete","id":"author","name":"author","variable":"author","value":"Dan Brown","dataset":"books","keep_na":true,"description":null,"active":true},{"type":"discrete","id":"program","name":"program","variable":"program","value":"premium","dataset":"borrowers","keep_na":false,"description":null,"active":true}]},{"step":"2","filters":[{"type":"range","id":"copies","name":"copies","variable":"copies","range":["-Inf",5],"dataset":"books","keep_na":true,"description":null,"active":true}]}]</span></span></code></pre></div>
<p>Then, having an empty cohort, use <code>restore</code> to apply the
configuration:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">librarian_cohort</span> <span class="op">&lt;-</span> <span class="va">librarian_source</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/create-cohort.html">cohort</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/restore.html">restore</a></span><span class="op">(</span><span class="va">librarian_cohort</span>, state <span class="op">=</span> <span class="va">state</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/sum_up.html">sum_up</a></span><span class="op">(</span><span class="va">librarian_cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; &gt;&gt; Step ID: 1</span></span>
<span><span class="co">#&gt; -&gt; Filter ID: author</span></span>
<span><span class="co">#&gt;    Filter Type: discrete</span></span>
<span><span class="co">#&gt;    Filter Parameters:</span></span>
<span><span class="co">#&gt;      dataset: books</span></span>
<span><span class="co">#&gt;      variable: author</span></span>
<span><span class="co">#&gt;      value: Dan Brown</span></span>
<span><span class="co">#&gt;      keep_na: TRUE</span></span>
<span><span class="co">#&gt;      description: </span></span>
<span><span class="co">#&gt;      active: TRUE</span></span>
<span><span class="co">#&gt; -&gt; Filter ID: program</span></span>
<span><span class="co">#&gt;    Filter Type: discrete</span></span>
<span><span class="co">#&gt;    Filter Parameters:</span></span>
<span><span class="co">#&gt;      dataset: borrowers</span></span>
<span><span class="co">#&gt;      variable: program</span></span>
<span><span class="co">#&gt;      value: premium</span></span>
<span><span class="co">#&gt;      keep_na: FALSE</span></span>
<span><span class="co">#&gt;      description: </span></span>
<span><span class="co">#&gt;      active: TRUE</span></span>
<span><span class="co">#&gt; &gt;&gt; Step ID: 2</span></span>
<span><span class="co">#&gt; -&gt; Filter ID: copies</span></span>
<span><span class="co">#&gt;    Filter Type: range</span></span>
<span><span class="co">#&gt;    Filter Parameters:</span></span>
<span><span class="co">#&gt;      dataset: books</span></span>
<span><span class="co">#&gt;      variable: copies</span></span>
<span><span class="co">#&gt;      range: -Inf, 5</span></span>
<span><span class="co">#&gt;      keep_na: TRUE</span></span>
<span><span class="co">#&gt;      description: </span></span>
<span><span class="co">#&gt;      active: TRUE</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Krystian Igras.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
